From cc42abf50c05aee531c1444f8d878bc9fc62a711 Mon Sep 17 00:00:00 2001
From: mancoast <RobertPancoast77@gmail.com>
Date: Sat, 17 Dec 2016 16:05:56 -0500
Subject: [PATCH] Include Static LIBS in NuGet

---
 gsl-msvc14-x64-build.nuget.bat | 34 +++++++++++++++++++++++++++++++++-
 gsl-msvc14-x64.nuspec          |  2 +-
 2 files changed, 34 insertions(+), 2 deletions(-)

diff --git a/gsl-msvc14-x64-build.nuget.bat b/gsl-msvc14-x64-build.nuget.bat
index c3827da..93f5f27 100644
--- a/gsl-msvc14-x64-build.nuget.bat
+++ b/gsl-msvc14-x64-build.nuget.bat
@@ -1,7 +1,7 @@
 REM @echo off
 
 Echo GSL Windows Build NuGet
-REM set INCREMENTDISABLE=true
+set INCREMENTDISABLE=true
 
 REM # XEON x64 Build Vars #
 set _SCRIPT_DRIVE=%~d0
@@ -52,14 +52,46 @@ msbuild gsl.sln /p:Configuration=Release /m
 
 :copy_files
 set BINDIR=%SRC%\build-nuget\
+rd /s /q %BINDIR%
+mkdir %BINDIR%
 echo %BINDIR%
 xcopy %BUILDTREE%Release\gsl* %BINDIR%
 xcopy %BUILDTREE%bin\Release\gsl.dll %BINDIR%
 del %BINDIR%gsl
 xcopy /I %BUILDTREE%gsl %BINDIR%gsl
 
+mkdir %BUILDTREE%Static
+cd %BUILDTREE%Static
+
+:static_GSL
+REM # GSL STATIC #
+if exist %BUILDTREE%Static\Release\gsl.lib (
+    if exist %BUILDTREE%Static\Release\gslcblas.lib (
+		ECHO GSL Libs Found
+		GOTO:copy_static_files
+	)
+)
+
+ECHO %cmake_platform% STATIC
+cmake -G %cmake_platform% ^
+-DBUILD_SHARED_LIBS:BOOL=OFF ^
+-DCMAKE_CXX_FLAGS_RELEASE="/MD" ^
+-DCMAKE_CXX_FLAGS_DEBUG="/MDd" ^
+-DCMAKE_C_FLAGS_RELEASE="/MD" ^
+-DCMAKE_C_FLAGS_DEBUG="/MDd" ^
+-DCMAKE_BUILD_TYPE="Release" %SRC%
+msbuild gsl.sln /p:Configuration=Release /m
+
+:copy_static_files
+set BINDIR=%SRC%\build-nuget\static
+rd /s /q %BINDIR%
+mkdir %BINDIR%
+echo %BINDIR%
+xcopy %BUILDTREE%Static\Release\gsl* %BINDIR%
+
 :nuget_req
 REM # make nuget packages from binaries #
+cd %BUILDTREE%
 nuget pack %SRC%\gsl-msvc14-x64.nuspec
 
 GOTO:eof
diff --git a/gsl-msvc14-x64.nuspec b/gsl-msvc14-x64.nuspec
index 21694f7..515a539 100644
--- a/gsl-msvc14-x64.nuspec
+++ b/gsl-msvc14-x64.nuspec
@@ -2,7 +2,7 @@
 <package xmlns="http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd">
     <metadata>
         <id>gsl-msvc14-x64</id>
-        <version>2.2.1.2477</version>
+        <version>2.2.1.2577</version>
         <authors>administrator</authors>
         <requireLicenseAcceptance>false</requireLicenseAcceptance>
         <description>Release GSL as NuGet package.</description>
-- 
2.10.0

